{{- define "main" }}

<header class="page-header">
  <h1>{{- (printf "%s&nbsp;" .Title ) | htmlUnescape -}}</h1>
  {{- if .Description }}
  <div class="post-description">{{ .Description }}</div>
  {{- end }} {{- if not (.Param "hideMeta") }}
  <div class="post-meta">{{- partial "translation_list.html" . -}}</div>
  {{- end }}
</header>

<script>
  const sendMessage = async function (e) {
    e.preventDefault();

    // using Twilio SendGrid's v3 Node.js Library
    // https://github.com/sendgrid/sendgrid-nodejs
    const sgMail = require("@sendgrid/mail");
    sgMail.setApiKey(process.env.SENDGRID_API_KEY);
    const msg = {
      to: "xander@xandergrab.com",
      from: document.getElementById("email").value,
      subject: document.getElementById("subject").value,
      text: document.getElementById("body").value,
      // html: "<strong>and easy to do anywhere, even with Node.js</strong>",
    };

    try {
      await sgMail.send(msg).then((result) => {
        console.log("Email sent");
        response.setStatusCode(200);
        response.setBody({ success: true });
      });
    } catch (error) {
      console.error(error);
    }
  };
</script>
<div id="searchbox">
  <form
    action="return sendMessage(this)"
    method="POST"
    id="contact-form"
    enctype="text/plain"
  >
    Subject:<br />
    <input type="text" name="subject" placeholder="Your Name" /><br />
    Email:<br />
    <input type="email" name="email" placeholder="Your Email" /><br />
    Message:<br />
    <textarea
      name="body"
      rows="5"
      cols="30"
      placeholder="Your Message"
    ></textarea
    ><br />
    <button type="submit" name="sendButton">Send</button>
  </form>
</div>

{{- end }}{{/* end main */}}

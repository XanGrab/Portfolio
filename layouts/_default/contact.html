{{- define "main" }}

<header class="page-header">
  <h1>{{- (printf "%s&nbsp;" .Title ) | htmlUnescape -}}</h1>
  {{- if .Description }}
  <div class="post-description">{{ .Description }}</div>
  {{- end }} {{- if not (.Param "hideMeta") }}
  <div class="post-meta">{{- partial "translation_list.html" . -}}</div>
  {{- end }}
</header>

<script>
  export const sendMessage = async function (e) {
    e.preventDefault();
    // using Twilio SendGrid's v3 Node.js Library
    // https://github.com/sendgrid/sendgrid-nodejs
    const sgMail = require("@sendgrid/mail");

    sgMail.setApiKey(process.env.SENDGRID_API_KEY);
    const msg = {
      to: process.env.TO_EMAIL_ADDRESS,
      from: { email: process.env.FROM_EMAIL_ADDRESS, name: "Contact Form" },
      replyTo: document.getElementById("email").value,
      subject: `[Contact Form] ${document.getElementById("subject").value}`,
      text: `From ${document.getElementById("email").value}:\n\n${
        document.getElementById("body").value
      }`,
    };

    try {
      await sgMail.send(msg).then((result) => {
        console.log("DEBUG [contact.html] Email sent");
        response.setStatusCode(200);
        response.setBody({ success: true });
        return callback(null, response);
      });
    } catch (error) {
      console.error(error);
    }
  };
</script>
<div id="searchbox">
  <form
    action="return sendMessage(this)"
    method="POST"
    id="contact-form"
    enctype="text/plain"
  >
    Subject:<br />
    <input type="text" name="subject" placeholder="Your Name" /><br />
    Reply-To Email:<br />
    <input type="email" name="email" placeholder="Your Email" /><br />
    Message:<br />
    <textarea
      name="body"
      rows="5"
      cols="30"
      placeholder="Your Message"
    ></textarea
    ><br />
    <button type="submit" name="sendButton">Send</button>
  </form>
</div>

{{- end }}{{/* end main */}}
